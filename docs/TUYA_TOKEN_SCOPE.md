# Tuya Token/è´¦æˆ·å½’å±èŒƒå›´
## Tuya Token/Account Scope

**æœ€åæ›´æ–°**: 2025-11-21

---

## ğŸ” é—®é¢˜

> "for now the tuya token account is member specifics or household specifics?"

**å›ç­”**: **æ··åˆæ¨¡å¼** - Tuya Home æ˜¯ Household çº§åˆ«çš„ï¼Œä½†ç”¨æˆ·ç™»å½•æ˜¯ Member çº§åˆ«çš„ã€‚

---

## ğŸ“‹ å½“å‰æ¶æ„

### 1. Tuya Home IDï¼ˆHousehold çº§åˆ«ï¼‰âœ…

**å­˜å‚¨ä½ç½®**: `households.tuya_home_id`

```prisma
model Household {
  tuyaHomeId String? @unique @map("tuya_home_id")
  // ...
}
```

**ç‰¹ç‚¹**:
- âœ… ä¸€ä¸ª Household å¯¹åº”ä¸€ä¸ª Tuya Home
- âœ… å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ‰€æœ‰æˆå‘˜å…±äº«
- âœ… é€šè¿‡ `/api/mqtt/tuya/home` API ç®¡ç†æ˜ å°„å…³ç³»

**ç¤ºä¾‹**:
```
Household "æˆ‘çš„å®¶" (id: abc123)
  â””â”€ tuyaHomeId: "tuya_home_xyz789"
```

---

### 2. Tuya ç”¨æˆ·ç™»å½• Tokenï¼ˆMember/è®¾å¤‡çº§åˆ«ï¼‰âš ï¸

**å­˜å‚¨ä½ç½®**: ç›®å‰**ä¸åœ¨æ•°æ®åº“ä¸­**ï¼Œç”± iOS/Android SDK åœ¨è®¾å¤‡æœ¬åœ°ç®¡ç†

**ç‰¹ç‚¹**:
- âš ï¸ æ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„è®¾å¤‡ä¸Šç™»å½• Tuya è´¦æˆ·
- âš ï¸ Token å­˜å‚¨åœ¨è®¾å¤‡æœ¬åœ°ï¼ˆiOS Keychain/Android SharedPreferencesï¼‰
- âš ï¸ ç™»å½•çŠ¶æ€æ˜¯è®¾å¤‡çº§åˆ«çš„ï¼Œä¸æ˜¯æ•°æ®åº“çº§åˆ«çš„

**å½“å‰å®ç°**:
```swift
// iOS æ’ä»¶ä¸­
ThingSmartUser.sharedInstance().isLogin  // æ£€æŸ¥è®¾å¤‡ä¸Šçš„ç™»å½•çŠ¶æ€
```

---

## ğŸ—ï¸ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Smart Warehouse                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Household "æˆ‘çš„å®¶" (id: abc123)                         â”‚
â”‚    â””â”€ tuyaHomeId: "tuya_home_xyz789"  â† Householdçº§åˆ«   â”‚
â”‚                                                           â”‚
â”‚  Members:                                                 â”‚
â”‚    â”œâ”€ User A (è®¾å¤‡1)                                      â”‚
â”‚    â”‚   â””â”€ Tuyaç™»å½•Token (è®¾å¤‡æœ¬åœ°) â† Member/è®¾å¤‡çº§åˆ«      â”‚
â”‚    â”‚                                                       â”‚
â”‚    â”œâ”€ User B (è®¾å¤‡2)                                      â”‚
â”‚    â”‚   â””â”€ Tuyaç™»å½•Token (è®¾å¤‡æœ¬åœ°) â† Member/è®¾å¤‡çº§åˆ«      â”‚
â”‚    â”‚                                                       â”‚
â”‚    â””â”€ User C (è®¾å¤‡3)                                      â”‚
â”‚        â””â”€ Tuyaç™»å½•Token (è®¾å¤‡æœ¬åœ°) â† Member/è®¾å¤‡çº§åˆ«      â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ æ‰€æœ‰æˆå‘˜é€šè¿‡å„è‡ªçš„è®¾å¤‡ç™»å½•å
         â”‚ éƒ½å¯ä»¥è®¿é—®åŒä¸€ä¸ª Tuya Home
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tuya Cloud                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Tuya Home (id: tuya_home_xyz789)                        â”‚
â”‚    â”œâ”€ Device 1                                            â”‚
â”‚    â”œâ”€ Device 2                                            â”‚
â”‚    â””â”€ Device 3                                            â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ å½“å‰é—®é¢˜

### é—®é¢˜ 1: å¤šç”¨æˆ·å…±äº« Tuya Home

**åœºæ™¯**:
- Household "æˆ‘çš„å®¶" æœ‰ 3 ä¸ªæˆå‘˜ï¼ˆUser A, B, Cï¼‰
- æ‰€æœ‰æˆå‘˜éƒ½éœ€è¦è®¿é—®åŒä¸€ä¸ª Tuya Home ä¸­çš„è®¾å¤‡

**å½“å‰å®ç°**:
- âœ… Tuya Home ID å­˜å‚¨åœ¨ Household çº§åˆ«ï¼ˆå…±äº«ï¼‰
- âš ï¸ æ¯ä¸ªç”¨æˆ·éœ€è¦åœ¨è‡ªå·±çš„è®¾å¤‡ä¸Šç™»å½• Tuya è´¦æˆ·
- âš ï¸ å¦‚æœä½¿ç”¨è®¿å®¢ç™»å½•ï¼Œæ¯ä¸ªè®¾å¤‡ä¼šåˆ›å»ºä¸åŒçš„è®¿å®¢è´¦æˆ·

**æ½œåœ¨é—®é¢˜**:
- å¦‚æœä½¿ç”¨è®¿å®¢ç™»å½•ï¼Œæ¯ä¸ªè®¾å¤‡å¯èƒ½æœ‰ä¸åŒçš„è®¿å®¢è´¦æˆ·
- ä¸åŒè®¾å¤‡çš„è®¿å®¢è´¦æˆ·å¯èƒ½æ— æ³•è®¿é—®åŒä¸€ä¸ª Tuya Home

---

### é—®é¢˜ 2: Token ä¸åœ¨æ•°æ®åº“ä¸­

**å½“å‰çŠ¶æ€**:
- Tuya ç™»å½• token å­˜å‚¨åœ¨è®¾å¤‡æœ¬åœ°
- ä¸åœ¨æ•°æ®åº“ä¸­ï¼Œæ— æ³•è·¨è®¾å¤‡åŒæ­¥
- æ— æ³•åœ¨æœåŠ¡å™¨ç«¯ç®¡ç† token

**å½±å“**:
- ç”¨æˆ·æ¢è®¾å¤‡éœ€è¦é‡æ–°ç™»å½•
- æ— æ³•ä»æœåŠ¡å™¨ç«¯æ’¤é”€ token
- æ— æ³•ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç”¨æˆ·çš„ Tuya è´¦æˆ·

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å…±äº« Tuya è´¦æˆ·ï¼ˆæ¨èï¼‰

**å®ç°**:
- ä¸ºæ¯ä¸ª Household åˆ›å»ºä¸€ä¸ªå…±äº«çš„ Tuya è´¦æˆ·
- æ‰€æœ‰æˆå‘˜ä½¿ç”¨åŒä¸€ä¸ª Tuya è´¦æˆ·ç™»å½•
- å°† Tuya è´¦æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ Household çº§åˆ«

**æ•°æ®åº“è®¾è®¡**:
```prisma
model Household {
  tuyaHomeId      String? @unique
  tuyaAccount     String?  // Tuya è´¦æˆ·ï¼ˆé‚®ç®±/æ‰‹æœºå·ï¼‰
  tuyaPassword    String?  // åŠ å¯†å­˜å‚¨çš„å¯†ç 
  // ...
}
```

**ä¼˜ç‚¹**:
- âœ… æ‰€æœ‰æˆå‘˜å…±äº«åŒä¸€ä¸ª Tuya Home
- âœ… ç»Ÿä¸€ç®¡ç†
- âœ… è®¾å¤‡é—´åŒæ­¥

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦åˆ›å»ºå’Œç®¡ç†å…±äº«è´¦æˆ·
- âš ï¸ å¯†ç éœ€è¦åŠ å¯†å­˜å‚¨

---

### æ–¹æ¡ˆ 2: æ¯ä¸ªæˆå‘˜ä½¿ç”¨è‡ªå·±çš„ Tuya è´¦æˆ·

**å®ç°**:
- æ¯ä¸ªæˆå‘˜ä½¿ç”¨è‡ªå·±çš„ Tuya è´¦æˆ·ç™»å½•
- å°† Tuya è´¦æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ User çº§åˆ«
- é€šè¿‡ Tuya SDK çš„ Home å…±äº«åŠŸèƒ½ï¼Œè®©å¤šä¸ªè´¦æˆ·è®¿é—®åŒä¸€ä¸ª Home

**æ•°æ®åº“è®¾è®¡**:
```prisma
model User {
  tuyaAccount  String?
  tuyaPassword String?  // åŠ å¯†å­˜å‚¨
  // ...
}
```

**ä¼˜ç‚¹**:
- âœ… æ¯ä¸ªç”¨æˆ·ç®¡ç†è‡ªå·±çš„è´¦æˆ·
- âœ… æ›´å®‰å…¨ï¼ˆä¸ªäººè´¦æˆ·ï¼‰

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦ Tuya SDK æ”¯æŒ Home å…±äº«
- âš ï¸ ç®¡ç†æ›´å¤æ‚

---

### æ–¹æ¡ˆ 3: æ··åˆæ¨¡å¼ï¼ˆå½“å‰ + æ”¹è¿›ï¼‰

**å®ç°**:
- ä¿æŒå½“å‰æ¶æ„ï¼ˆTuya Home åœ¨ Household çº§åˆ«ï¼‰
- æ·»åŠ å¯é€‰çš„å…±äº« Tuya è´¦æˆ·ï¼ˆå­˜å‚¨åœ¨ Householdï¼‰
- å¦‚æœ Household æœ‰å…±äº«è´¦æˆ·ï¼Œæ‰€æœ‰æˆå‘˜ä½¿ç”¨å®ƒ
- å¦‚æœæ²¡æœ‰ï¼Œæ¯ä¸ªæˆå‘˜ä½¿ç”¨è‡ªå·±çš„è´¦æˆ·

**æ•°æ®åº“è®¾è®¡**:
```prisma
model Household {
  tuyaHomeId      String? @unique
  tuyaAccount     String?  // å¯é€‰çš„å…±äº«è´¦æˆ·
  tuyaPassword    String?  // åŠ å¯†å­˜å‚¨
  // ...
}

model User {
  tuyaAccount  String?  // å¯é€‰çš„ä¸ªäººè´¦æˆ·
  tuyaPassword String?
  // ...
}
```

**ä¼˜ç‚¹**:
- âœ… çµæ´»æ€§é«˜
- âœ… æ”¯æŒä¸¤ç§æ¨¡å¼

**ç¼ºç‚¹**:
- âš ï¸ å®ç°æ›´å¤æ‚

---

## ğŸ“ æ¨èæ–¹æ¡ˆ

### çŸ­æœŸï¼ˆå½“å‰ï¼‰

**ä¿æŒç°çŠ¶**:
- Tuya Home ID åœ¨ Household çº§åˆ« âœ…
- ç”¨æˆ·ç™»å½•åœ¨è®¾å¤‡çº§åˆ«ï¼ˆè®¿å®¢ç™»å½•ï¼‰âš ï¸
- æµ‹è¯•æ˜¯å¦æ‰€æœ‰è®¾å¤‡çš„è®¿å®¢è´¦æˆ·å¯ä»¥è®¿é—®åŒä¸€ä¸ª Tuya Home

---

### é•¿æœŸï¼ˆæ”¹è¿›ï¼‰

**å®ç°å…±äº« Tuya è´¦æˆ·**:
1. åœ¨ Household çº§åˆ«å­˜å‚¨ Tuya è´¦æˆ·ä¿¡æ¯
2. æ‰€æœ‰æˆå‘˜ä½¿ç”¨åŒä¸€ä¸ªè´¦æˆ·ç™»å½•
3. åœ¨æœåŠ¡å™¨ç«¯ç®¡ç†è´¦æˆ·å’Œ token

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `prisma/schema.prisma` - æ•°æ®åº“ schemaï¼ˆ`households.tuyaHomeId`ï¼‰
- `app/api/mqtt/tuya/home/route.ts` - Tuya Home æ˜ å°„ API
- `ios/App/App/Plugins/TuyaProvisioningPlugin.swift` - iOS æ’ä»¶ï¼ˆç”¨æˆ·ç™»å½•ï¼‰
- `lib/tuya-home-manager.ts` - Tuya Home ç®¡ç†å·¥å…·

---

## âœ… æ€»ç»“

**å½“å‰çŠ¶æ€**:
- **Tuya Home**: Household çº§åˆ« âœ…
- **Tuya ç™»å½• Token**: Member/è®¾å¤‡çº§åˆ« âš ï¸

**å»ºè®®**:
- çŸ­æœŸï¼šæµ‹è¯•å½“å‰å®ç°æ˜¯å¦å·¥ä½œ
- é•¿æœŸï¼šè€ƒè™‘å®ç°å…±äº« Tuya è´¦æˆ·ï¼ˆHousehold çº§åˆ«ï¼‰

---

**ä¸‹ä¸€æ­¥**: æµ‹è¯•å¤šç”¨æˆ·è®¿é—®åŒä¸€ä¸ª Tuya Home çš„åœºæ™¯ã€‚

